var $tooltip=$("<div class='tooltip top in'><div class='tooltip-inner'></div></div>").hide().appendTo("body");
var previousPoint=null;
function $$(a,b){return jQuery(a.replace(/(\[|\])/g,"\\$1"),b)
}Date.prototype.getWeekRange=function(){var b=this;
var d=b.getDay();
var g=b.getDate()-d+(d==0?-6:1);
var h=b.setDate(g);
var a=new Date(h);
var f=a.format();
var e=new Date(h);
e=new Date(e.setDate(e.getDate()+6));
var c=e.format();
return{startDate:a,endDate:e,sStartDate:f,sEndDate:c}
};
Date.prototype.format=function(c){if(!c){c="/"
}var b=this;
var a=("0"+(b.getMonth()+1)).slice(-2);
var e=("0"+b.getDate()).slice(-2);
var f=b.getFullYear();
return a+c+e+c+f
};
Date.prototype.getMonthRange=function(){var b=this;
var e=new Date(b.getFullYear(),b.getMonth(),1);
var d=new Date(b.getFullYear(),b.getMonth()+1,0);
var a=e.format();
var c=d.format();
return{startDate:e,endDate:d,sStartDate:a,sEndDate:c}
};
Date.prototype.firstDayInPreviousMonth=function(){return new Date(this.getFullYear(),this.getMonth()-1,1)
};
Date.prototype.lastDayInPreviousMonth=function(){return new Date(this.getFullYear(),this.getMonth(),0)
};
function DataBinder(object_id,dataObject){var pubSub=jQuery({});
var data_attr="bind-"+object_id,message=object_id+":change";
$("[data-"+data_attr+"]").each(function(e,i){var $bound=jQuery(this);
var attr_name=$bound.data(data_attr);
var i=attr_name.indexOf(":");
if(i>0){var arr=attr_name.split(":");
if(eval("typeof "+arr[0])==="function"){try{attr_name=eval(arr[0]+'(dataObject,"'+arr[1]+'")')
}catch(e){console.log("Can't evaluate "+data_attr+" : "+attr_name+" on element"+$bound.attr("name"))
}}}var val="";
try{val=eval("dataObject."+attr_name)
}catch(e){console.log("Error in evaluating expression "+attr_name)
}if($bound.is("input, textarea, select")){if($bound.is(":radio")){if($bound.val()==val){$bound.prop("checked",true)
}else{$bound.prop("checked",false)
}}else{if($bound.is(":checkbox")){if($bound.val()==val){$bound.prop("checked",true)
}else{$bound.prop("checked",false)
}}else{$bound.val(val)
}}}else{$bound.html(val)
}});
jQuery(document).on("change","[data-"+data_attr+"]",function(evt){var $input=jQuery(this);
var d=$input.data(data_attr);
pubSub.trigger(message,[d,$input.val(),$input])
});
pubSub.on(message,function(evt,prop_name,new_val){var attr_name=prop_name;
var i=attr_name.indexOf(":");
if(i>0){var arr=attr_name.split(":");
if(eval("typeof "+arr[0])==="function"){try{attr_name=eval(arr[0]+'(dataObject,"'+arr[1]+'")')
}catch(e){console.log("Can't evaluate "+prop_name+" : "+attr_name)
}}}try{if(isNaN(new_val)){eval("dataObject."+attr_name+"='"+new_val+"'")
}else{eval("dataObject."+attr_name+"="+new_val)
}}catch(e){}});
return pubSub
}function GenericBinder(uid,dataObject){var binder=new DataBinder(uid,dataObject);
$.extend({set:function(attr_name,val){eval("this.attr_name = val");
binder.trigger(uid+":change",[attr_name,val,this])
},get:function(attr_name){return eval("this.attr_name")
}},dataObject);
binder.on(uid+":change",function(evt,attr_name,new_val,initiator){try{if(initiator!==dataObject){eval("dataObject."+attr_name+" = new_val")
}}catch(e){}})
}function customMapper(obj,expr){var l=expr.length;
var ad=0;
var m=[];
var retVal="";
for(var i=0;
i<l;
i++){switch(expr.charAt(i)){case"[":m[ad]=i;
ad++;
break;
case"]":var c=evalArray(eval("obj."+retVal),expr.substring(m[ad-1]+1,i));
retVal+="["+c+"]";
ad--;
break;
default:if(ad==0){retVal+=expr.charAt(i)
}break
}}console.log(retVal);
return retVal
}function evalArray(obj,expr){if(typeof obj==="object"&&expr.indexOf(".")<0){return obj
}else{if(typeof obj==="array"||obj.length!=null&&expr.indexOf("=")>0){for(var i=0;
i<obj.length;
i++){var j=eval("obj["+i+"]."+expr.split("=")[0]);
if(j==expr.split("=")[1]){return i
}}}}}(function($){$("select.select-time-range").each(function(i,e){var widget=$(this).parent().parent().parent();
widget.find(".start").val(new Date().getMonthRange().sStartDate);
widget.find(".end").val(new Date().getMonthRange().sEndDate)
});
$(document).on("change",".select-time-range",function(){var sel=$(this).val();
var widget=$(this).parent().parent().parent();
switch(sel){case"THIS_MONTH":widget.find(".start").val(new Date().getMonthRange().sStartDate);
widget.find(".end").val(new Date().getMonthRange().sEndDate);
break;
case"LAST_SEVEN_DAYS":widget.find(".start").val(new Date().getWeekRange().sStartDate);
widget.find(".end").val(new Date().getWeekRange().sEndDate);
break;
case"LAST_MONTH":widget.find(".start").val(new Date().firstDayInPreviousMonth().format());
widget.find(".end").val(new Date().lastDayInPreviousMonth().format());
break;
case"ALL_TIME":widget.find(".start").val(new Date("2000-01-01").getMonthRange().sStartDate);
widget.find(".end").val(new Date().getWeekRange().sEndDate);
break
}});
$(document).on("click","input.datepicker",function(e){var widget=$(this).parent().parent().parent();
widget.find(".select-time-range").val("CUSTOM")
});
$.fn.drawPieChart=function(placeholder,data,data_formatter){var options={series:{pie:{show:true,tilt:0.8,highlight:{opacity:0.25},stroke:{color:"#fff",width:2},startAngle:2}},legend:{show:true,position:"ne",labelBoxBorderColor:null,margin:[0,0]},grid:{hoverable:true,clickable:true},colors:["green","blue","yellow","purple"]};
if(typeof placeholder=="string"){placeholder=$("#"+placeholder)
}var widget=placeholder.parent().parent().parent();
if(typeof data=="string"){$(this).CRUD({url:data,method:"POST",data:JSON.stringify({startDate:Date.parse(widget.find(".start").val()),endDate:Date.parse(widget.find(".end").val())}),success:function(data,textStatus,jqXHR){var formatted_data=[];
if(typeof data_formatter==="string"){eval(data_formatter+"(data, formatted_data)");
plotInternal(formatted_data,options)
}else{console.log("data format provider not defined.")
}}})
}else{plotInternal(data,options)
}function plotInternal(data,options){if(!data||!data.length){placeholder.text("No Data to draw.");
return
}else{placeholder.empty().css({width:"90%","min-height":"210px"});
$.plot(placeholder,data,options)
}}placeholder.on("plothover",function(event,pos,item){if(item){if(previousPoint!=item.seriesIndex){previousPoint=item.seriesIndex;
var tip=item.series.label+" : "+item.series.percent.toFixed(2)+"%";
$tooltip.show().children(0).text(tip)
}$tooltip.css({top:pos.pageY+10,left:pos.pageX+10})
}else{$tooltip.hide();
previousPoint=null
}})
};
$.fn.drawBarChart=function(placeholder,data,data_formatter){var options={hoverable:true,shadowSize:0,series:{lines:{show:true},points:{show:true}},xaxes:[{mode:"time",timeformat:"%m/%d",tickPadding:0,color:"black",axisLabel:"Date(mm/dd)",position:"bottom",axisLabelUseCanvas:false,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10}],yaxes:[{axisLabel:"Total sale(USD)",min:0,axisLabelUseCanvas:true,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:3,tickFormatter:function(v,axis){return $.formatNumber(v,{format:"#,###",locale:"us"})
}}],grid:{backgroundColor:{colors:["#fff","#fff"]},borderWidth:1,borderColor:"#555"}};
if(typeof placeholder=="string"){placeholder=$("#"+placeholder)
}var widget=placeholder.parent().parent();
if(typeof data=="string"){$(this).CRUD({url:data,method:"POST",data:JSON.stringify({startDate:Date.parse(widget.find(".start").val()),endDate:Date.parse(widget.find(".end").val())}),success:function(data,textStatus,jqXHR){var formatted_data=[];
if(typeof data_formatter==="string"){eval(data_formatter+"(data, formatted_data)");
plotInternal(formatted_data,options)
}else{console.log("data format provider not defined.")
}}})
}else{if(typeof data_formatter==="string"){var formatted_data=[];
eval(data_formatter+"(data, formatted_data)");
data=formatted_data
}plotInternal(data,options)
}function plotInternal(data,options){if(!data||!data.length){placeholder.text("No Data to draw.");
return
}else{placeholder.empty().css({width:"90%","min-height":"150px"});
$.plot(placeholder,[{label:"Total sales",data:data}],options)
}$(document).on("plothover",placeholder,function(event,pos,item){if(item){if(previousPoint!=item.seriesIndex){previousPoint=item.seriesIndex;
var tip=item.series.label+" : "+item.series.percent.toFixed(2)+"%";
console.log(tip);
$tooltip.show().children(0).text(tip)
}$tooltip.css({top:pos.pageY+10,left:pos.pageX+10})
}else{$tooltip.hide();
previousPoint=null
}})
}}
}(jQuery));
(function(a){a.ajaxSetup({cache:false,xhrFields:{withCredentials:true}});
a.fn.CRUD=function(b){var c=a.extend({url:"",method:"GET",cache:false,data:null,contentType:"application/json"},b);
c.url="/cm-rest/"+c.url;
a.ajax(c);
return this
};
a(document).ajaxError(function(d,e,c,b){console.log(b)
});
a(document).ajaxSend(function(d,c,b){switch(typeof b.message){case"undefined":a("#wait-message").html('<i class="icon-spinner icon-spin green bigger-125"></i> Please wait...');
a("#wait-message").show();
break;
case"string":a("#wait-message").html(b.message);
a("#wait-message").show();
break;
case"boolean":a("#wait-modal").modal("show");
break;
case"function":b.message();
break;
default:a("#wait-message").show();
break
}});
a(document).ajaxError(function(d,c,b){if(typeof b.message=="object"){a.gritter.add({title:b.message.title,text:b.message.text})
}if(c.status==401){a.gritter.add({title:"Session expired",text:"Your session has expired. Please login again.",after_close:function(f,g){window.location="login.jsp"
}})
}});
a.gritter.options.position="center-top";
a(document).ajaxSuccess(function(d,c,b){if(typeof b.message=="object"){a.gritter.add({title:b.message.title,text:b.message.text})
}});
a(document).ajaxComplete(function(d,c,b){if(jQuery.active-1==0){a("#wait-message").hide();
a("#wait-modal").modal("hide")
}});
if(a.CM==null||typeof a.CM=="undefined"){a.CM={}
}a.CM.pullorder=function(d){var b="/aggregators/channels/pull";
if(d!=null){var c=tableimportchannel.fnGetData(d[0]);
b="/aggregators/channels/"+c.channelId+"/pull"
}a(this).CRUD({method:"GET",url:b,success:function(e){a.gritter.add({title:"Pull Order",text:e});
a.CM.updateOrderSummary()
},error:function(f,e,g){},message:true})
};
a.CM.processOrders=function(){a(this).CRUD({url:"aggregators/orders/processed/bulk/process",data:JSON.stringify(null),method:"POST",success:function(b){a.gritter.add({title:"Order Processing Update",text:b.length+" Order(s) processed."});
if(typeof a.CM.updateOrderSummary==="function"){a.CM.updateOrderSummary()
}},message:true})
};
a.CM.updateOrderSummary=function(){a(this).CRUD({method:"POST",url:"aggregators/reports",data:JSON.stringify({startDate:new Date().getMonthRange().startDate.getTime(),endDate:new Date().getMonthRange().endDate.getTime()}),success:function(g,b,o){try{a("#tasks").empty();
var h=g.productsales;
var l=g.suppliersales;
var p=g.channelsales;
var d=[];
var n=[];
for(var f=0;
f<g.overAllSales.length;
f++){var c=new Date(g.overAllSales[f].date);
d.push([c.getTime(),g.overAllSales[f].totalSales])
}a(this).drawBarChart("sales-charts",d);
for(var f=0;
f<p.length;
f++){var q='<li class="item-orange clearfix"><label class="inline"> <span>'+p[f].name+'</span> </label><div class="pull-right">$'+p[f].totalSales+"</div></li>";
a(q).appendTo("#tasks");
n.push({label:p[f].name,data:p[f].totalSales})
}var k=[];
for(var f=0;
f<l.length;
f++){var q='<li class="item-orange clearfix"><label class="inline"> <span>'+l[f].name+'</span> </label><div class="pull-right">$'+l[f].totalSales+"</div></li>";
a(q).appendTo("#tasks1");
k.push({label:l[f].name,data:l[f].totalSales})
}var m=[];
for(var f=0;
f<h.length;
f++){var q='<li class="item-orange clearfix"><label class="inline"> <span>'+h[f].sku+'</span> </label><div class="pull-right">$'+h[f].totalSales+"</div></li>";
a(q).appendTo("#tasks2");
m.push({label:h[f].sku,data:h[f].totalSales})
}a("#unprocessedCount span.infobox-data-number").html(g.OrderSummaryData.unprocessedCount);
a("#unprocessedValue span.infobox-data-number").html("$"+g.OrderSummaryData.unprocessedAmount.toFixed(2));
a("#unresolvedCount span.infobox-data-number").html(g.OrderSummaryData.unresolvedCount);
a("#unresolvedValue span.infobox-data-number").html("$"+g.OrderSummaryData.unresolvedAmount.toFixed(2));
a("strong.unresolvedcount").html(g.OrderSummaryData.unresolvedCount)
}catch(j){console.log("Report box not present.")
}}})
}
}(jQuery));
$.fn.dataTableExt.oApi.fnReloadAjax=function(g,d,h,c){if($.fn.dataTable.versionCheck){var e=new $.fn.dataTable.Api(g);
if(d){e.ajax.url(d).load(h,!c)
}else{e.ajax.reload(h,!c)
}return
}if(d!==undefined&&d!==null){g.sAjaxSource=d
}if(g.oFeatures.bServerSide){this.fnDraw();
return
}this.oApi._fnProcessingDisplay(g,true);
var f=this;
var a=g._iDisplayStart;
var b=[];
this.oApi._fnServerParams(g,b);
g.fnServerData.call(g.oInstance,g.sAjaxSource,b,function(l){f.oApi._fnClearTable(g);
var j=(g.sAjaxDataProp!=="")?f.oApi._fnGetObjectDataFn(g.sAjaxDataProp)(l):l;
for(var k=0;
k<j.length;
k++){f.oApi._fnAddData(g,j[k])
}g.aiDisplay=g.aiDisplayMaster.slice();
f.fnDraw();
if(c===true){g._iDisplayStart=a;
f.oApi._fnCalculateEnd(g);
f.fnDraw(false)
}f.oApi._fnProcessingDisplay(g,false);
if(typeof h=="function"&&h!==null){h(g)
}},g)
};
(function(a){a.fn.serializefiles=function(){var c=a(this);
var b=new FormData();
a.each(a(c).find("input[type=file]"),function(f,e){a.each(a(e)[0].files,function(h,g){b.append(e.name,g)
})
});
var d=a(c).serializeArray();
a.each(d,function(e,f){b.append(f.name,f.value)
});
return b
}
})(jQuery);
